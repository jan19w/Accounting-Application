# 日期格式修复说明

## 问题描述
之前日期显示为ISO格式：`2025-11-09T16:00:00.000Z`  
现在修复为简洁格式：`2025-11-09`

## 解决方案

### 1. 后端修复（server/server.js）
在查询API中使用MySQL的 `DATE_FORMAT` 函数格式化日期：

```javascript
// 修改前
db.query('SELECT * FROM details ORDER BY date DESC', ...)

// 修改后
db.query('SELECT id, type, category, amount, DATE_FORMAT(date, "%Y-%m-%d") as date, note, created_at, updated_at FROM details ORDER BY date DESC', ...)
```

**优势：**
- 直接在数据库层面格式化
- 减少前端处理负担
- 统一数据格式

### 2. 前端工具函数（src/utils/dateFormat.js）
创建日期格式化工具函数，用于处理任何可能的日期格式：

```javascript
export function formatDate(dateInput) {
  if (!dateInput) return '';
  
  let date;
  if (typeof dateInput === 'string') {
    date = new Date(dateInput);
  } else if (dateInput instanceof Date) {
    date = dateInput;
  } else {
    return '';
  }
  
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  
  return `${year}-${month}-${day}`;
}
```

**优势：**
- 兼容ISO日期格式、Date对象等多种输入
- 统一的格式化逻辑
- 可复用

### 3. 前端组件更新

#### TransactionList.jsx
表格中显示日期时使用格式化函数：

```javascript
import { formatDate } from '../utils/dateFormat.js';

// 在表格中
<td>{formatDate(row.date)}</td>
```

#### TransactionForm.jsx
编辑表单加载数据时格式化日期：

```javascript
import { formatDate } from '../utils/dateFormat.js';

useEffect(() => { 
  setForm(editing ? { 
    ...editing, 
    amount: String(editing.amount),
    date: formatDate(editing.date) // 确保日期格式正确
  } : DEFAULT); 
}, [editing]);
```

## 修改的文件

1. ✅ `server/server.js` - 后端查询API
2. ✅ `src/utils/dateFormat.js` - 新增工具函数
3. ✅ `src/components/TransactionList.jsx` - 表格显示
4. ✅ `src/components/TransactionForm.jsx` - 表单编辑

## 效果对比

### 修改前：
```
日期列显示：2025-11-09T16:00:00.000Z
编辑时显示：2025-11-09T16:00:00.000Z
```

### 修改后：
```
日期列显示：2025-11-09
编辑时显示：2025-11-09
```

## 测试步骤

1. **重启后端服务器**
   ```bash
   cd server
   node server.js
   ```

2. **刷新前端页面**
   确保React应用已重新加载最新代码

3. **查看表格**
   日期列应显示为 `2025-11-09` 格式

4. **测试编辑功能**
   - 点击任意记录的"编辑"按钮
   - 日期输入框应显示正确的 `YYYY-MM-DD` 格式
   - 修改后保存，日期格式保持正确

5. **测试新增功能**
   - 点击"记一笔"按钮
   - 选择日期，添加记录
   - 查看表格中的日期格式是否正确

## 注意事项

- 数据库中的 `date` 字段类型应该是 `DATE` 类型（而非 `DATETIME` 或 `TIMESTAMP`）
- 如果之前有使用 `DATETIME` 类型，建议迁移到 `DATE` 类型
- 前端日期选择器 `<input type="date">` 会自动处理 `YYYY-MM-DD` 格式

## 额外优化

如果需要显示更友好的日期格式（如"2025年11月9日"），可以扩展 `dateFormat.js`：

```javascript
export function formatDateChinese(dateInput) {
  const formatted = formatDate(dateInput);
  if (!formatted) return '';
  
  const [year, month, day] = formatted.split('-');
  return `${year}年${parseInt(month)}月${parseInt(day)}日`;
}
```

## 完成！

现在所有日期都以简洁的 `YYYY-MM-DD` 格式显示，不再出现冗长的ISO时间戳格式。


